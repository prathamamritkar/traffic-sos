/* ── Layout ─────────────────────────────────────────────────────── */
.container {
    position: relative;
    width: 100%;
    height: 100%;
    /* Ensure Leaflet interactions reach through */
    pointer-events: auto;
}

.map {
    width: 100%;
    height: 100%;
    border-radius: inherit;
    /* Pointer events must be explicit so Leaflet panes receive touch/mouse */
    pointer-events: auto;
    touch-action: none; /* let Leaflet own touch gestures */
}

/* ── Legend — M3 Surface Container High + glass elevation ───────── */
.legend {
    position: absolute;
    bottom: 24px;
    left: 16px;
    /* z-index 401 = just above Leaflet's tilePane (200) & overlayPane (400)
       but below Leaflet's markerPane (600) and controls (1000) */
    z-index: 401;
    background: var(--md-sys-color-surface-container-high);
    backdrop-filter: blur(16px) saturate(1.6);
    -webkit-backdrop-filter: blur(16px) saturate(1.6);
    border: 1px solid var(--md-sys-color-outline-variant);
    border-radius: var(--radius-md);
    padding: 10px 14px;
    display: flex;
    flex-direction: column;
    gap: 7px;
    min-width: 152px;
    box-shadow: var(--shadow-lg);
    font-family: var(--font-sans);
    color: var(--md-sys-color-on-surface);
    font-size: var(--text-caption);
    /* Never intercept map interactions */
    pointer-events: none;
    /* Smooth theme transition */
    transition:
        background var(--duration-medium) var(--easing-standard),
        border-color var(--duration-medium) var(--easing-standard),
        box-shadow var(--duration-medium) var(--easing-standard);
}

/* ── Keyframes ──────────────────────────────────────────────────── */
/*
  Dash period = dash(16) + gap(20) = 36 px.
  Moving the offset by exactly -36 px per cycle produces a seamless,
  perfectly looping flow (one dash smoothly replacing the next).
  5 s = slow cinematic drift for unselected routes.
  3.5 s = purposeful urgency for the selected (active) route.
*/
@keyframes ambFlowAnim {
    from { stroke-dashoffset: 0; }
    to   { stroke-dashoffset: -36; }
}

@keyframes ambFlowSelectedAnim {
    from { stroke-dashoffset: 0; }
    to   { stroke-dashoffset: -36; }
}

/* Corridor dash period = 14+22 = 36 px — same grid, distinct color */
@keyframes corridorFlowAnim {
    from { stroke-dashoffset: 0; }
    to   { stroke-dashoffset: -36; }
}

/* Glow pulse adapts to theme via stroke-opacity (not color) */
@keyframes glowPulse {
    0%, 100% { stroke-opacity: 0.08; }
    50%       { stroke-opacity: 0.20; }
}

@keyframes corridorGlowPulse {
    0%, 100% { stroke-opacity: 0.10; }
    50%       { stroke-opacity: 0.25; }
}

/* ── Ambulance route — Layer 1: glow halo ───────────────────────── */
.ambGlow path {
    animation: glowPulse 2.4s ease-in-out infinite;
    will-change: stroke-opacity;
}

/* ── Ambulance route — Layer 2: solid backbone ──────────────────── */
.ambSolid path {
    transition:
        stroke-width var(--duration-long) var(--easing-standard),
        stroke-opacity var(--duration-long) var(--easing-standard);
}

/* ── Ambulance route — Layer 3: flowing dashes (unselected) ─────── */
.ambFlow path {
    /* 5 s: slow, calm drift — readable without drawing attention */
    animation: ambFlowAnim 5s linear infinite;
    will-change: stroke-dashoffset;
}

/* ── Ambulance route — Layer 3: flowing dashes (selected) ───────── */
.ambFlowSelected path {
    /* 3.5 s: quicker flow signals active priority route */
    animation: ambFlowSelectedAnim 3.5s linear infinite;
    will-change: stroke-dashoffset;
}

/* ── Ambulance route — Layer 4: arrow ticks ─────────────────────── */
.ambArrow path {
    transition: stroke-opacity var(--duration-long) var(--easing-standard);
}

/* ── Green corridor — Layer 1: glow halo ────────────────────────── */
.corridorGlow path {
    animation: corridorGlowPulse 2.8s ease-in-out infinite;
    will-change: stroke-opacity;
}

/* ── Green corridor — Layer 2: outer stroke ─────────────────────── */
.corridorOuter path {
    transition: stroke-width var(--duration-long) var(--easing-standard);
}

/* ── Green corridor — Layer 3: solid backbone ───────────────────── */
.corridorSolid path {
    transition:
        stroke-width var(--duration-long) var(--easing-standard),
        stroke-opacity var(--duration-long) var(--easing-standard);
}

/* ── Green corridor — Layer 4: inner highlight ──────────────────── */
.corridorInner path {
    transition: stroke-opacity var(--duration-long) var(--easing-standard);
}

/* ── Green corridor — Layer 5: animated flow dashes ─────────────── */
.corridorFlow path {
    /* 4 s: slightly faster than ambulance to feel alive but not frantic */
    animation: corridorFlowAnim 4s linear infinite;
    will-change: stroke-dashoffset;
}
